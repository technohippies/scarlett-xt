var Q=Object.defineProperty;var X=(e,t,r)=>t in e?Q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var q=(e,t,r)=>X(e,typeof t!="symbol"?t+"":t,r);function ee(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}const re=[EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,globalThis.DOMException,globalThis.AssertionError,globalThis.SystemError].filter(Boolean).map(e=>[e.name,e]),se=new Map(re);class L extends Error{constructor(r){super(L._prepareSuperMessage(r));q(this,"name","NonError")}static _prepareSuperMessage(r){try{return JSON.stringify(r)}catch{return String(r)}}}const ne=[{property:"name",enumerable:!1},{property:"message",enumerable:!1},{property:"stack",enumerable:!1},{property:"code",enumerable:!0},{property:"cause",enumerable:!1}],$=new WeakSet,te=e=>{$.add(e);const t=e.toJSON();return $.delete(e),t},G=e=>se.get(e)??Error,B=({from:e,seen:t,to:r,forceEnumerable:l,maxDepth:y,depth:_,useToJSON:d,serialize:x})=>{if(!r)if(Array.isArray(e))r=[];else if(!x&&W(e)){const g=G(e.name);r=new g}else r={};if(t.push(e),_>=y)return r;if(d&&typeof e.toJSON=="function"&&!$.has(e))return te(e);const m=g=>B({from:g,seen:[...t],forceEnumerable:l,maxDepth:y,depth:_,useToJSON:d,serialize:x});for(const[g,A]of Object.entries(e)){if(A&&A instanceof Uint8Array&&A.constructor.name==="Buffer"){r[g]="[object Buffer]";continue}if(A!==null&&typeof A=="object"&&typeof A.pipe=="function"){r[g]="[object Stream]";continue}if(typeof A!="function"){if(!A||typeof A!="object"){try{r[g]=A}catch{}continue}if(!t.includes(e[g])){_++,r[g]=m(e[g]);continue}r[g]="[Circular]"}}for(const{property:g,enumerable:A}of ne)typeof e[g]<"u"&&e[g]!==null&&Object.defineProperty(r,g,{value:W(e[g])?m(e[g]):e[g],enumerable:l?!0:A,configurable:!0,writable:!0});return r};function ie(e,t={}){const{maxDepth:r=Number.POSITIVE_INFINITY,useToJSON:l=!0}=t;return typeof e=="object"&&e!==null?B({from:e,seen:[],forceEnumerable:!0,maxDepth:r,depth:0,useToJSON:l,serialize:!0}):typeof e=="function"?`[Function: ${e.name||"anonymous"}]`:e}function ae(e,t={}){const{maxDepth:r=Number.POSITIVE_INFINITY}=t;if(e instanceof Error)return e;if(ge(e)){const l=G(e.name);return B({from:e,seen:[],to:new l,maxDepth:r,depth:0,serialize:!1})}return new L(e)}function W(e){return!!e&&typeof e=="object"&&"name"in e&&"message"in e&&"stack"in e}function ge(e){return!!e&&typeof e=="object"&&"message"in e&&!Array.isArray(e)}var oe=Object.defineProperty,le=Object.defineProperties,me=Object.getOwnPropertyDescriptors,U=Object.getOwnPropertySymbols,Ae=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable,z=(e,t,r)=>t in e?oe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,J=(e,t)=>{for(var r in t||(t={}))Ae.call(t,r)&&z(e,r,t[r]);if(U)for(var r of U(t))ce.call(t,r)&&z(e,r,t[r]);return e},V=(e,t)=>le(e,me(t)),ue=(e,t,r)=>new Promise((l,y)=>{var _=m=>{try{x(r.next(m))}catch(g){y(g)}},d=m=>{try{x(r.throw(m))}catch(g){y(g)}},x=m=>m.done?l(m.value):Promise.resolve(m.value).then(_,d);x((r=r.apply(e,t)).next())});function de(e){let t,r={};function l(){Object.entries(r).length===0&&(t==null||t(),t=void 0)}let y=Math.floor(Math.random()*1e4);function _(){return y++}return{sendMessage(d,x,...m){return ue(this,null,function*(){var g,A,f,E;const T={id:_(),type:d,data:x,timestamp:Date.now()},k=(A=yield(g=e.verifyMessageData)==null?void 0:g.call(e,T))!=null?A:T;(f=e.logger)==null||f.debug(`[messaging] sendMessage {id=${k.id}} ─ᐅ`,k,...m);const M=yield e.sendMessage(k,...m),{res:c,err:p}=M??{err:new Error("No response")};if((E=e.logger)==null||E.debug(`[messaging] sendMessage {id=${k.id}} ᐊ─`,{res:c,err:p}),p!=null)throw ae(p);return c})},onMessage(d,x){var m,g,A;if(t==null&&((m=e.logger)==null||m.debug(`[messaging] "${d}" initialized the message listener for this context`),t=e.addRootListener(f=>{var E,T;if(typeof f.type!="string"||typeof f.timestamp!="number"){if(e.breakError)return;const c=Error(`[messaging] Unknown message format, must include the 'type' & 'timestamp' fields, received: ${JSON.stringify(f)}`);throw(E=e.logger)==null||E.error(c),c}(T=e==null?void 0:e.logger)==null||T.debug("[messaging] Received message",f);const k=r[f.type];if(k==null)return;const M=k(f);return Promise.resolve(M).then(c=>{var p,O;return(O=(p=e.verifyMessageData)==null?void 0:p.call(e,c))!=null?O:c}).then(c=>{var p;return(p=e==null?void 0:e.logger)==null||p.debug(`[messaging] onMessage {id=${f.id}} ─ᐅ`,{res:c}),{res:c}}).catch(c=>{var p;return(p=e==null?void 0:e.logger)==null||p.debug(`[messaging] onMessage {id=${f.id}} ─ᐅ`,{err:c}),{err:ie(c)}})})),r[d]!=null){const f=Error(`[messaging] In this JS context, only one listener can be setup for ${d}`);throw(g=e.logger)==null||g.error(f),f}return r[d]=x,(A=e.logger)==null||A.log(`[messaging] Added listener for ${d}`),()=>{delete r[d],l()}},removeAllListeners(){Object.keys(r).forEach(d=>{delete r[d]}),l()}}}var j={exports:{}},xe=j.exports,Z;function fe(){return Z||(Z=1,function(e,t){(function(r,l){l(e)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:xe,function(r){var l,y;if(!((y=(l=globalThis.chrome)==null?void 0:l.runtime)!=null&&y.id))throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const _="The message port closed before a response was received.",d=x=>{const m={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(m).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class g extends WeakMap{constructor(n,a=void 0){super(a),this.createItem=n}get(n){return this.has(n)||this.set(n,this.createItem(n)),super.get(n)}}const A=s=>s&&typeof s=="object"&&typeof s.then=="function",f=(s,n)=>(...a)=>{x.runtime.lastError?s.reject(new Error(x.runtime.lastError.message)):n.singleCallbackArg||a.length<=1&&n.singleCallbackArg!==!1?s.resolve(a[0]):s.resolve(a)},E=s=>s==1?"argument":"arguments",T=(s,n)=>function(o,...b){if(b.length<n.minArgs)throw new Error(`Expected at least ${n.minArgs} ${E(n.minArgs)} for ${s}(), got ${b.length}`);if(b.length>n.maxArgs)throw new Error(`Expected at most ${n.maxArgs} ${E(n.maxArgs)} for ${s}(), got ${b.length}`);return new Promise((h,w)=>{if(n.fallbackToNoCallback)try{o[s](...b,f({resolve:h,reject:w},n))}catch(i){console.warn(`${s} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,i),o[s](...b),n.fallbackToNoCallback=!1,n.noCallback=!0,h()}else n.noCallback?(o[s](...b),h()):o[s](...b,f({resolve:h,reject:w},n))})},k=(s,n,a)=>new Proxy(n,{apply(o,b,h){return a.call(b,s,...h)}});let M=Function.call.bind(Object.prototype.hasOwnProperty);const c=(s,n={},a={})=>{let o=Object.create(null),b={has(w,i){return i in s||i in o},get(w,i,v){if(i in o)return o[i];if(!(i in s))return;let u=s[i];if(typeof u=="function")if(typeof n[i]=="function")u=k(s,s[i],n[i]);else if(M(a,i)){let C=T(i,a[i]);u=k(s,s[i],C)}else u=u.bind(s);else if(typeof u=="object"&&u!==null&&(M(n,i)||M(a,i)))u=c(u,n[i],a[i]);else if(M(a,"*"))u=c(u,n[i],a["*"]);else return Object.defineProperty(o,i,{configurable:!0,enumerable:!0,get(){return s[i]},set(C){s[i]=C}}),u;return o[i]=u,u},set(w,i,v,u){return i in o?o[i]=v:s[i]=v,!0},defineProperty(w,i,v){return Reflect.defineProperty(o,i,v)},deleteProperty(w,i){return Reflect.deleteProperty(o,i)}},h=Object.create(s);return new Proxy(h,b)},p=s=>({addListener(n,a,...o){n.addListener(s.get(a),...o)},hasListener(n,a){return n.hasListener(s.get(a))},removeListener(n,a){n.removeListener(s.get(a))}}),O=new g(s=>typeof s!="function"?s:function(a){const o=c(a,{},{getContent:{minArgs:0,maxArgs:0}});s(o)}),F=new g(s=>typeof s!="function"?s:function(a,o,b){let h=!1,w,i=new Promise(S=>{w=function(P){h=!0,S(P)}}),v;try{v=s(a,o,w)}catch(S){v=Promise.reject(S)}const u=v!==!0&&A(v);if(v!==!0&&!u&&!h)return!1;const C=S=>{S.then(P=>{b(P)},P=>{let R;P&&(P instanceof Error||typeof P.message=="string")?R=P.message:R="An unexpected error occurred",b({__mozWebExtensionPolyfillReject__:!0,message:R})}).catch(P=>{console.error("Failed to send onMessage rejected reply",P)})};return C(u?v:i),!0}),Y=({reject:s,resolve:n},a)=>{x.runtime.lastError?x.runtime.lastError.message===_?n():s(new Error(x.runtime.lastError.message)):a&&a.__mozWebExtensionPolyfillReject__?s(new Error(a.message)):n(a)},D=(s,n,a,...o)=>{if(o.length<n.minArgs)throw new Error(`Expected at least ${n.minArgs} ${E(n.minArgs)} for ${s}(), got ${o.length}`);if(o.length>n.maxArgs)throw new Error(`Expected at most ${n.maxArgs} ${E(n.maxArgs)} for ${s}(), got ${o.length}`);return new Promise((b,h)=>{const w=Y.bind(null,{resolve:b,reject:h});o.push(w),a.sendMessage(...o)})},K={devtools:{network:{onRequestFinished:p(O)}},runtime:{onMessage:p(F),onMessageExternal:p(F),sendMessage:D.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:D.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},I={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return m.privacy={network:{"*":I},services:{"*":I},websites:{"*":I}},c(x,K,m)};r.exports=d(chrome)}else r.exports=globalThis.browser})}(j)),j.exports}var be=fe();const N=ee(be);function pe(e){return de(V(J({},e),{sendMessage(t,r){if(r==null)return N.runtime.sendMessage(t);const l=typeof r=="number"?{tabId:r}:r;return N.tabs.sendMessage(l.tabId,t,l.frameId!=null?{frameId:l.frameId}:void 0)},addRootListener(t){const r=(l,y)=>t(typeof l=="object"?V(J({},l),{sender:y}):l);return N.runtime.onMessage.addListener(r),()=>N.runtime.onMessage.removeListener(r)}}))}const H=pe(),ye=H.onMessage,we=H.sendMessage;export{ee as g,ye as o,we as s};
